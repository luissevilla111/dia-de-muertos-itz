<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Serpiente Cempas√∫chil - D√≠a de Muertos</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="./main.css">
</head>
<body>
  <header class="site-header">
    <nav class="nav">
      <a class="logo" href="./index.html">D√≠a de Muertos</a>
      <ul class="nav-links">
        <li><a href="./index.html#ofrenda">Ofrenda</a></li>
        <li><a href="./index.html#tradicion">Tradici√≥n</a></li>
        <li><a href="./index.html#contacto">Contacto</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <div class="game-container">
      <h1 class="game-title">üêç Serpiente Cempas√∫chil</h1>
      <p class="game-subtitle">Recoge las flores de cempas√∫chil</p>
      
      <div class="game-board">
        <div class="score">Puntuaci√≥n: <span id="score">0</span></div>
        <canvas id="gameCanvas" width="400" height="400"></canvas>
      </div>

      <div class="game-controls">
        <button class="btn-game" id="startBtn">Iniciar Juego</button>
        <a class="btn ghost" href="./index.html">Volver al Inicio</a>
      </div>

      <div class="instructions">
        <strong>Controles:</strong> Usa las flechas del teclado (‚Üë ‚Üì ‚Üê ‚Üí) para mover la serpiente
      </div>
    </div>

    <div class="game-over" id="gameOver">
      <div class="game-over-content">
        <h2 class="game-over-title">¬°Juego Terminado!</h2>
        <p class="final-score">Puntuaci√≥n Final: <span id="finalScore">0</span></p>
        <button class="btn-game" id="restartBtn">Jugar de Nuevo</button>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <p>Hecho con cari√±o en M√©xico ¬∑ ¬© <span id="year"></span></p>
  </footer>

  <script src="./main.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // Juego de la serpiente
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const finalScoreEl = document.getElementById('finalScore');
    const gameOverEl = document.getElementById('gameOver');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');

    const GRID_SIZE = 20;
    const TILE_COUNT = canvas.width / GRID_SIZE;

    let snake = [{x: 10, y: 10}];
    let food = {x: 15, y: 15};
    let dx = 0;
    let dy = 0;
    let score = 0;
    let gameLoop = null;
    let gameRunning = false;

    const COLORS = {
      snake: '#f59e0b',
      snakeHead: '#ffb24c',
      food: '#ef4444',
      grid: 'rgba(255,255,255,0.05)'
    };

    function drawGrid() {
      ctx.strokeStyle = COLORS.grid;
      ctx.lineWidth = 1;
      for (let i = 0; i <= TILE_COUNT; i++) {
        ctx.beginPath();
        ctx.moveTo(i * GRID_SIZE, 0);
        ctx.lineTo(i * GRID_SIZE, canvas.height);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0, i * GRID_SIZE);
        ctx.lineTo(canvas.width, i * GRID_SIZE);
        ctx.stroke();
      }
    }

    function drawSnake() {
      snake.forEach((segment, index) => {
        ctx.fillStyle = index === 0 ? COLORS.snakeHead : COLORS.snake;
        ctx.fillRect(
          segment.x * GRID_SIZE + 1,
          segment.y * GRID_SIZE + 1,
          GRID_SIZE - 2,
          GRID_SIZE - 2
        );
        
        if (index === 0) {
          ctx.fillStyle = 'rgba(0,0,0,0.3)';
          ctx.fillRect(segment.x * GRID_SIZE + 6, segment.y * GRID_SIZE + 6, 4, 4);
          ctx.fillRect(segment.x * GRID_SIZE + 10, segment.y * GRID_SIZE + 6, 4, 4);
        }
      });
    }

    function drawFood() {
      ctx.fillStyle = COLORS.food;
      ctx.beginPath();
      ctx.arc(
        food.x * GRID_SIZE + GRID_SIZE / 2,
        food.y * GRID_SIZE + GRID_SIZE / 2,
        GRID_SIZE / 2 - 2,
        0,
        Math.PI * 2
      );
      ctx.fill();
      
      ctx.fillStyle = '#fbbf24';
      ctx.beginPath();
      ctx.arc(
        food.x * GRID_SIZE + GRID_SIZE / 2,
        food.y * GRID_SIZE + GRID_SIZE / 2,
        GRID_SIZE / 4,
        0,
        Math.PI * 2
      );
      ctx.fill();
    }

    function moveSnake() {
      const head = {x: snake[0].x + dx, y: snake[0].y + dy};
      
      if (head.x < 0 || head.x >= TILE_COUNT || 
          head.y < 0 || head.y >= TILE_COUNT ||
          snake.some(segment => segment.x === head.x && segment.y === head.y)) {
        endGame();
        return;
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        score++;
        scoreEl.textContent = score;
        spawnFood();
      } else {
        snake.pop();
      }
    }

    function spawnFood() {
      let newFood;
      do {
        newFood = {
          x: Math.floor(Math.random() * TILE_COUNT),
          y: Math.floor(Math.random() * TILE_COUNT)
        };
      } while (snake.some(segment => segment.x === newFood.x && segment.y === newFood.y));
      food = newFood;
    }

    function draw() {
      ctx.fillStyle = 'rgba(12, 10, 15, 0.95)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      drawGrid();
      drawFood();
      drawSnake();
    }

    function gameStep() {
      moveSnake();
      draw();
    }

    function startGame() {
      if (gameRunning) return;
      
      // Reiniciar variables
      snake = [{x: 10, y: 10}];
      food = {x: 15, y: 15};
      dx = 0;
      dy = 0;
      score = 0;
      scoreEl.textContent = score;
      gameRunning = true;
      
      // Actualizar bot√≥n
      startBtn.textContent = 'Jugando...';
      startBtn.disabled = true;
      
      // Dibujar estado inicial
      draw();
      
      // NO iniciar el loop a√∫n, esperar el primer movimiento
    }

    function endGame() {
      if (gameLoop) {
        clearInterval(gameLoop);
        gameLoop = null;
      }
      gameRunning = false;
      startBtn.textContent = 'Iniciar Juego';
      startBtn.disabled = false;
      finalScoreEl.textContent = score;
      gameOverEl.classList.add('show');
    }

    function resetGame() {
      gameOverEl.classList.remove('show');
      startGame();
    }

    document.addEventListener('keydown', (e) => {
      // Prevenir scroll de la p√°gina
      if(['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
        e.preventDefault();
      }
      
      if (!gameRunning) return;
      
      // Primera tecla presionada inicia el juego
      if (!gameLoop) {
        switch(e.key) {
          case 'ArrowUp':
            dx = 0; dy = -1;
            break;
          case 'ArrowDown':
            dx = 0; dy = 1;
            break;
          case 'ArrowLeft':
            dx = -1; dy = 0;
            break;
          case 'ArrowRight':
            dx = 1; dy = 0;
            break;
          default:
            return;
        }
        // Iniciar el loop despu√©s de la primera tecla
        gameLoop = setInterval(gameStep, 150);
      } else {
        // Cambiar direcci√≥n durante el juego
        switch(e.key) {
          case 'ArrowUp':
            if (dy === 0) { dx = 0; dy = -1; }
            break;
          case 'ArrowDown':
            if (dy === 0) { dx = 0; dy = 1; }
            break;
          case 'ArrowLeft':
            if (dx === 0) { dx = -1; dy = 0; }
            break;
          case 'ArrowRight':
            if (dx === 0) { dx = 1; dy = 0; }
            break;
        }
      }
    });

    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', resetGame);

    // Dibujar estado inicial
    draw();
  </script>
</body>
</html>